SELECT *
FROM `subsidiaries`
WHERE exists(SELECT *
             FROM `subsidiaries_desks`
             WHERE `subsidiaries_desks`.`subsidiary_id` = `subsidiaries`.`id` AND exists(SELECT *
                                                                                         FROM
                                                                                           `cashiers`
                                                                                         WHERE
                                                                                           `subsidiaries_desks`.`cashier_id`
                                                                                           =
                                                                                           `cashiers`.`id`
                                                                                           AND
                                                                                           `authorized`
                                                                                           RLIKE
                                                                                           "\D1\D"
                                                                                           AND
                                                                                           `cashiers`.`deleted_at`
                                                                                           IS NULL))
      AND `subsidiaries`.`deleted_at` IS NULL;

UPDATE OCustomers_test.customers
SET nick         = 'apack', created_at = '2016-09-06 23:11:25', updated_at = '2016-09-06 23:11:25',
  deleted_at     = NULL, invoice_number = 1, un_invoice_number = 1,
  full_name      = 'Instalación de un cliente con panel', code = '49910', short_name = 'CLIENTE',
  invoice_format = 'F-%''.05d-C', un_invoice_format = 'NC-%''.05d-C',
  web            = 'http://panel.cliente.localwamp.dev/',
  emails         = '[{"type":"Informaci\\u00f3n","email":"info@orama.com.mx"},{"type":"Contacto","email":"contacto@orama.com.mx"},{"type":"Inscripciones","email":"inscripciones@orama.com.mx"}]',
  phones         = '[{"type":"Facturaci\\u00f3n","phone":"+52 (33) 1522 2777, ext: 26"},{"type":"Administrativo","phone":"+52 (33) 1522 2777, ext: 26"},{"type":"Contacto","phone":"+52 (33) 1522 2777, ext: 26"}]',
  contract       = '{"backup":0,"historic":4.5,"active":{"0":9,"100":9,"300":8,"500":7,"750":6},"billing":{"taxid":"XAXX010101000","name":"Cliente muestra de Orama","address":{"direction":{"street":"Calle","out_number":"exterior","inside_number":"interior","suburb":"Colonia"},"zip":"c\\u00f3digo postal","location":{"municipality":"Municipio","city":"Ciudad","state":"C\\u00f3digo de estado","country":"C\\u00f3digo de pa\\u00eds"}},"phones":[{"type":"Facturaci\\u00f3n","phone":"+52 (33) 1522 2777, ext: 26"}],"emails":[{"type":"Facturaci\\u00f3n","email":"facturas@orama.com.mx"}]}}',
  invoices       = '{"taxid":"XAXX010101000","name":"Cliente muestra de Orama","address":{"direction":{"street":"Calle","out_number":"exterior","inside_number":"interior","suburb":"Colonia"},"zip":"c\\u00f3digo postal","location":{"municipality":"Municipio","city":"Ciudad","state":"C\\u00f3digo de estado","country":"C\\u00f3digo de pa\\u00eds"},"phones":[{"type":"Facturaci\\u00f3n","phone":"+52 (33) 1522 2777, ext: 26"}],"emails":[{"type":"Facturaci\\u00f3n","email":"facturas@orama.mx"}]},"public":{"taxid":"XAXX010101000","business_name":"Publico en general","address":{"direction":{"street":"Calle","out_number":"exterior","inside_number":"interior","suburb":"Colonia"},"zip":"c\\u00f3digo postal","location":{"municipality":"Municipio","city":"Ciudad","state":"C\\u00f3digo de estado","country":"C\\u00f3digo de pa\\u00eds"},"phones":[{"type":"Facturaci\\u00f3n","phone":"+52 (33) 1522 2777, ext: 26"}]},"email":"facturas@orama.mx"},"certificate":"Cadena de certificado","taxation":"PERSONA MORAL","key":"Cadena de certificado","validity":{"start_at":"2016-04-04T00:00:00-0600","end_at":"2017-04-04T00:00:00-0600"},"locale":"cfdi","cfdi":{"api":{"class":"InterScape","url":"http:\\/\\/www.scapebusiness.mx\\/AppFactura.asmx?wsdl","user":"Usuario\\/RFC","password":"contrase\\u00f1a"}}}',
  config         = '{"banks":{"BanBajio":{"TipoDeConcepto":{"service":"###","reference":"###","name":"Nombre del concepto","account":"###"}}}}',
  `database`     = '{"invoice":{"class":"InterScape","url-externa":"https://orama.3utilities.com/AppFactura.asmx?wsdl","url":"https://172.16.110.171/AppFactura.asmx?wsdl"},"banks":{"BanBajio":{"TipoDeConcepto":{"service":"###","reference":"###","name":"Nombre del concepto","account":"###"}}},"sms":[],"pack":{"over_base":0.5}}'
WHERE id = 2;

;

CREATE VIEW price_recommendations AS
  SELECT DISTINCT
    MD5(CONCAT_WS('-', container_id, content_sound)) AS id,
    container_id,
    AVG(price)                                       AS price,
    content,
    content_sound
  FROM packages
  WHERE price > 0 AND content_sound NOT IN (
    SELECT DISTINCT content_sound
    FROM prices)
  GROUP BY container_id, content_sound;


REPLACE INTO OCustomers_test.`customers` VALUES (1,'base','base','2016-10-22 02:58:20','2016-10-22 02:58:20',NULL,'Instalación base','50010','BASE','{\"responsable\":\"Nombre completo del responsable\",\"emails\":[{\"type\":\"Informaci\\u00f3n\",\"email\":\"info@orama.mx\"},{\"type\":\"Contacto\",\"email\":\"contacto@orama.mx\"},{\"type\":\"Inscripciones\",\"email\":\"inscripciones@orama\"}],\"phones\":[{\"type\":\"Facturaci\\u00f3n\",\"phone\":\"+52 (33) 1522 2777, ext: 26\"},{\"type\":\"Administrativo\",\"phone\":\"+52 (33) 1522 2777, ext: 26\"},{\"type\":\"Contacto\",\"phone\":\"+52 (33) 1522 2777, ext: 26\"}]}','[{\"range\":[3500],\"type\":1,\"description\":\"Registro de RFC\",\"periodicity\":\"Y\",\"currency\":\"MXN\",\"unit\":1},{\"range\":[0],\"type\":1,\"description\":\"Timbres fiscales\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":0},{\"range\":[75],\"type\":1,\"description\":\"Hosting\",\"periodicity\":\"Y-m\",\"currency\":\"USD\",\"unit\":1},{\"range\":[16],\"type\":1,\"description\":\"Acceso Europa\",\"periodicity\":\"Y-m\",\"currency\":\"USD\",\"unit\":0},{\"range\":[29],\"type\":1,\"description\":\"Acceso Asia y Oriente\",\"periodicity\":\"Y-m\",\"currency\":\"USD\",\"unit\":0},{\"range\":{\"0\":0,\"20000\":0.05},\"type\":2,\"description\":\"Emails\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":\"php:\\/\\/class|sql:\\/\\/function\"},{\"range\":[0],\"type\":1,\"description\":\"Respaldo\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":0},{\"range\":[0],\"type\":1,\"description\":\"Usuarios\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":0},{\"range\":{\"0\":19,\"100\":12,\"700\":9,\"2000\":6},\"type\":2,\"description\":\"Alumnos\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":\"php:\\/\\/class|sql:\\/\\/function\"},{\"range\":{\"0\":9,\"250\":6,\"1000\":4},\"type\":2,\"description\":\"Cliente\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":\"php:\\/\\/class|sql:\\/\\/function\"},{\"range\":{\"0\":2.65,\"250\":1.75,\"1000\":1.5},\"type\":3,\"description\":\"SMS por cliente\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"limit\":2,\"unit\":\"php:\\/\\/class|sql:\\/\\/function\"}]','{\"taxid\":\"AAA010101AAA\",\"name\":\"DEMO FISCAL BASE\",\"address\":{\"zip\":\"10000\",\"geo_point\":{\"lat\":0,\"lng\":0,\"raodZoom\":0,\"satelliteZoom\":0,\"heading\":0},\"location\":{\"municipality\":\"La Magdalena Contreras\",\"city\":\"DF\",\"state\":\"DF\",\"country\":\"MX\"},\"directions\":{\"street\":\"Calle\",\"out_number\":0,\"inside_number\":\"0\",\"suburb\":{\"zip\":\"10000\",\"name\":\"Lomas Quebradas\",\"type\":\"Colonia\",\"municipality\":\"La Magdalena Contreras\",\"state\":\"Distrito Federal\",\"city\":\"\\u00c1lvaro Obreg\\u00f3n\",\"search\":\"\\u00c1lvaro Obreg\\u00f3n, Distrito Federal, Colonia, Lomas Quebradas, La Magdalena Contreras, 10000\"}},\"phones\":[]},\"emails\":[{\"type\":\"Facturaci\\u00f3n\",\"email\":\"facturas_pruebas@plascencia.uno\"}]}','{\"invoice\":{\"class\":\"InterScape\",\"url\":\"https:\\/\\/fac104.zapto.org\\/AppFactura.asmx?wsdl\"},\"banks\":{\"BanBajio\":{\"TipoDeConcepto\":{\"service\":\"###\",\"reference\":\"###\",\"name\":\"Nombre del concepto\",\"account\":\"###\"}}},\"sms\":{}}','{\"nombre\":{\"driver\":\"mysql\",\"host\":\"localhost\",\"port\":\"3306\",\"database\":\"cliente_base\",\"username\":\"oramaLocal\",\"password\":\"OramaGeneral1\",\"charset\":\"utf8\",\"collation\":\"utf8_unicode_ci\",\"prefix\":\"\",\"strict\":false,\"engine\":null},\"installation\":{\"driver\":\"mysql\",\"host\":\"localhost\",\"port\":\"3306\",\"database\":\"apack_test\",\"username\":\"O3Apack\",\"password\":\"GedeonKcapaO3\",\"charset\":\"utf8\",\"collation\":\"utf8_unicode_ci\",\"prefix\":\"\",\"strict\":false,\"engine\":null}}'),(2,'apack','paqueteria','2016-10-22 02:58:20','2016-10-22 02:58:25',NULL,'Instalación de un cliente con panel','49910','CLIENTE','{\"responsable\":\"Nombre completo del responsable\",\"emails\":[{\"type\":\"Informaci\\u00f3n\",\"email\":\"info@orama.mx\"},{\"type\":\"Contacto\",\"email\":\"contacto@orama.mx\"},{\"type\":\"Inscripciones\",\"email\":\"inscripciones@orama\"}],\"phones\":[{\"type\":\"Facturaci\\u00f3n\",\"phone\":\"+52 (33) 1522 2777, ext: 26\"},{\"type\":\"Administrativo\",\"phone\":\"+52 (33) 1522 2777, ext: 26\"},{\"type\":\"Contacto\",\"phone\":\"+52 (33) 1522 2777, ext: 26\"}]}','[{\"range\":[3500],\"type\":1,\"description\":\"Registro de RFC\",\"periodicity\":\"Y\",\"currency\":\"MXN\",\"unit\":1},{\"range\":{\"0\":0.05},\"type\":2,\"description\":\"Paquete\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":\"php://class|sql://function\"},{\"range\":{\"0\":0.3},\"type\":2,\"description\":\"Registro de paquete\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":\"php://class|sql://function\"},{\"range\":{\"0\":0.55},\"type\":2,\"description\":\"Envío\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":\"php://class|sql://function\"},{\"range\":[0],\"type\":1,\"description\":\"Timbres fiscales\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":0},{\"range\":[55],\"type\":1,\"description\":\"Hosting\",\"periodicity\":\"Y-m\",\"currency\":\"USD\",\"unit\":1},{\"range\":{\"0\":0,\"20000\":0.05},\"type\":2,\"description\":\"Emails\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":\"php://class|sql://function\"},{\"range\":[0],\"type\":1,\"description\":\"Respaldo\",\"periodicity\":\"Y-m\",\"currency\":\"MXN\",\"unit\":0}]','{\"taxid\":\"AAA010101AAA\",\"name\":\"DEMO FISCAL BASE\",\"address\":{\"zip\":\"10000\",\"geo_point\":{\"lat\":0,\"lng\":0,\"raodZoom\":0,\"satelliteZoom\":0,\"heading\":0},\"location\":{\"municipality\":\"La Magdalena Contreras\",\"city\":\"DF\",\"state\":\"DF\",\"country\":\"MX\"},\"directions\":{\"street\":\"Calle\",\"out_number\":0,\"inside_number\":\"0\",\"suburb\":{\"zip\":\"10000\",\"name\":\"Lomas Quebradas\",\"type\":\"Colonia\",\"municipality\":\"La Magdalena Contreras\",\"state\":\"Distrito Federal\",\"city\":\"\\u00c1lvaro Obreg\\u00f3n\",\"search\":\"\\u00c1lvaro Obreg\\u00f3n, Distrito Federal, Colonia, Lomas Quebradas, La Magdalena Contreras, 10000\"}},\"phones\":[]},\"emails\":[{\"type\":\"Facturaci\\u00f3n\",\"email\":\"facturas@example.com\"}]}','{\"invoice\":{\"class\":\"InterScape\",\"url\":\"https:\\/\\/fac104.zapto.org\\/AppFactura.asmx?wsdl\"},\"banks\":{\"BanBajio\":{\"TipoDeConcepto\":{\"service\":\"###\",\"reference\":\"###\",\"name\":\"Nombre del concepto\",\"account\":\"###\"}}},\"sms\":[],\"pack\":{\"over_base\":0.5}}','{\"nombre\":{\"driver\":\"mysql\",\"host\":\"localhost\",\"port\":\"3306\",\"database\":\"cliente_base\",\"username\":\"oramaLocal\",\"password\":\"OramaGeneral1\",\"charset\":\"utf8\",\"collation\":\"utf8_unicode_ci\",\"prefix\":\"\",\"strict\":false,\"engine\":null},\"installation\":{\"driver\":\"mysql\",\"host\":\"localhost\",\"port\":\"3306\",\"database\":\"apack_test\",\"username\":\"O3Apack\",\"password\":\"GedeonKcapaO3\",\"charset\":\"utf8\",\"collation\":\"utf8_unicode_ci\",\"prefix\":\"\",\"strict\":false,\"engine\":null}}');
